<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="analytics.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.6/purify.min.js" integrity="sha512-jB0TkTBeQC9ZSkBqDhdmfTv1qdfbWpGE72yJ/01Srq6hEzZIz2xkz1e57p9ai7IeHMwEG7HpzG6NdptChif5Pg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/ui/auth.js"></script>
    <script src="/ui/api.js"></script>
    <script src="/ui/sanitize.js"></script>

    <title>ðŸ“Š Analytics Dashboard - AI Chatbot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" integrity="sha512-L0Shl7nXXzIlBSUUPpxrokqq4ojqgZFQczTYlGjzONGTDAcLremjwaWv5A+EDLnxhQzY5xUZPWLOLqYRkY0Cbw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/ui/analytics.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1><i class="fas fa-chart-line"></i> Analytics Dashboard</h1>
            <div class="nav-links">
                <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Inicio</a>
                <a href="business_config.html" class="nav-link"><i class="fas fa-cog"></i> Configurar</a>
                <a href="chat.html" class="nav-link"><i class="fas fa-comments"></i> Chat</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Selector de tiempo -->
        <div class="time-selector">
            <button class="time-btn active" data-hours="1">1 Hora</button>
            <button class="time-btn" data-hours="24">24 Horas</button>
            <button class="time-btn" data-hours="168">7 DÃ­as</button>
            <button class="time-btn" data-hours="720">30 DÃ­as</button>
        </div>

        <!-- MÃ©tricas principales -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon conversations">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div>
                        <div class="metric-value" id="totalConversations">-</div>
                        <div class="metric-label">Conversaciones Totales</div>
                    </div>
                </div>
                <div class="metric-change positive" id="conversationsChange">+0%</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon messages">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div>
                        <div class="metric-value" id="avgMessages">-</div>
                        <div class="metric-label">Mensajes Promedio</div>
                    </div>
                </div>
                <div class="metric-change positive" id="messagesChange">+0%</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon apis">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <div>
                        <div class="metric-value" id="apiCalls">-</div>
                        <div class="metric-label">Llamadas API</div>
                    </div>
                </div>
                <div class="metric-change positive" id="apiChange">+0%</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon errors">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div>
                        <div class="metric-value" id="errorRate">-</div>
                        <div class="metric-label">Tasa de Error</div>
                    </div>
                </div>
                <div class="metric-change negative" id="errorChange">0%</div>
            </div>
        </div>

        <!-- GrÃ¡ficos -->
        <div class="charts-section">
            <div class="chart-card">
                <div class="chart-title">Conversaciones por Hora</div>
                <div class="chart-container">
                    <canvas id="conversationsChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <div class="chart-title">Uso de APIs</div>
                <div class="chart-container">
                    <canvas id="apiUsageChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Estado de APIs -->
        <div class="api-usage-section">
            <h2 class="chart-title">Estado de Proveedores de IA</h2>
            <div id="apiProviders">
                <!-- Los proveedores se cargarÃ¡n dinÃ¡micamente -->
            </div>
        </div>

        <!-- Datos en tiempo real -->
        <div class="realtime-section">
            <div class="realtime-header">
                <h2 class="chart-title">Tiempo Real (Ãšltimos 5 minutos)</h2>
                <button class="refresh-btn" id="refreshRealtimeBtn">
                    <i class="fas fa-sync"></i> Actualizar
                </button>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="realtimeConversations">0</div>
                    <div class="metric-label">Nuevas Conversaciones</div>
                </div>

                <div class="metric-card">
                    <div class="metric-value" id="realtimeApiCalls">0</div>
                    <div class="metric-label">Llamadas API</div>
                </div>

                <div class="metric-card">
                    <div class="metric-value" id="realtimeErrors">0</div>
                    <div class="metric-label">Errores</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div class="loading hidden" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Cargando datos...</p>
    </div>
    <!-- compatibility marker: requireAuth('/ui/login.html') -->
    <!-- compatibility marker: apiJson( window.Api -->
</body>
</html>
