<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="common.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.6/purify.min.js" integrity="sha512-jB0TkTBeQC9ZSkBqDhdmfTv1qdfbWpGE72yJ/01Srq6hEzZIz2xkz1e57p9ai7IeHMwEG7HpzG6NdptChif5Pg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/ui/auth.js"></script>
    <script src="/ui/api.js"></script>
    <script src="/ui/sanitize.js"></script>

    <title>üìÖ Configuraci√≥n de Calendario - WhatsApp AI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="/ui/calendar_config.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-calendar-alt"></i> Configuraci√≥n de Calendario</h1>
            <p>Conecta tu Google Calendar o Outlook para gestionar citas autom√°ticamente</p>
        </div>
        
        <div class="content">
            <a href="index.html" class="back-link">
                <i class="fas fa-arrow-left"></i> Volver al Panel
            </a>
            
            <!-- Status Banner -->
            <div id="statusBanner" class="status-banner status-disconnected">
                <i class="fas fa-info-circle status-icon-large"></i>
                <div>
                    <strong>No hay calendario conectado</strong>
                    <p>Selecciona un proveedor y configura tus credenciales para comenzar</p>
                </div>
            </div>
            
            <!-- Provider Selection -->
            <div class="config-section">
                <h3><i class="fas fa-plug"></i> Selecciona tu Proveedor de Calendario</h3>
                
                <div class="provider-cards">
                    <div class="provider-card" id="googleCard" data-provider="google_calendar">
                        <div class="provider-icon google-icon">
                            <i class="fab fa-google"></i>
                        </div>
                        <div class="provider-name">Google Calendar</div>
                        <div class="provider-status" id="googleStatus">No conectado</div>
                        <button class="btn btn-primary" id="connectGoogleBtn">
                            <i class="fas fa-link"></i> Conectar
                        </button>
                    </div>
                    
                    <div class="provider-card" id="outlookCard" data-provider="outlook">
                        <div class="provider-icon outlook-icon">
                            <i class="fab fa-microsoft"></i>
                        </div>
                        <div class="provider-name">Microsoft Outlook</div>
                        <div class="provider-status" id="outlookStatus">No conectado</div>
                        <button class="btn btn-primary" id="connectOutlookBtn">
                            <i class="fas fa-link"></i> Conectar
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Google Calendar Setup -->
            <div class="config-section hidden" id="googleSetup">
                <h3><i class="fab fa-google"></i> Configuraci√≥n de Google Calendar</h3>
                
                <div class="help-text">
                    <h4><i class="fas fa-question-circle"></i> ¬øC√≥mo obtener las credenciales?</h4>
                    <ol>
                        <li>Ve a <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></li>
                        <li>Crea un nuevo proyecto o selecciona uno existente</li>
                        <li>Habilita la <strong>Google Calendar API</strong></li>
                        <li>Ve a "Credenciales" ‚Üí "Crear credenciales" ‚Üí "ID de cliente OAuth"</li>
                        <li>Selecciona "Aplicaci√≥n web" y agrega el redirect URI</li>
                        <li>Descarga el archivo JSON de credenciales</li>
                    </ol>
                </div>
                
                <div class="form-group">
                    <label>Archivo de Credenciales (credentials.json)</label>
                    <div class="credentials-upload" id="googleCredentialsUpload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Arrastra tu archivo credentials.json aqu√≠ o haz clic para seleccionar</p>
                        <input type="file" id="googleCredentialsFile" accept=".json" class="hidden-file-input">
                    </div>
                    <small>El archivo se almacena de forma segura en el servidor</small>
                </div>
                
                <div class="form-group">
                    <label>ID del Calendario</label>
                    <input type="text" id="googleCalendarId" placeholder="primary" value="primary">
                    <small>Usa "primary" para el calendario principal o el ID espec√≠fico del calendario</small>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="googleNotifications" checked>
                            Enviar notificaciones por email
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="googleMeet" checked>
                            Crear link de Google Meet
                        </label>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="saveGoogleConfigBtn">
                        <i class="fas fa-save"></i> Guardar Configuraci√≥n
                    </button>
                    <button class="btn btn-primary" id="authorizeGoogleBtn">
                        <i class="fas fa-key"></i> Autorizar Acceso
                    </button>
                </div>
            </div>
            
            <!-- Outlook Setup -->
            <div class="config-section hidden" id="outlookSetup">
                <h3><i class="fab fa-microsoft"></i> Configuraci√≥n de Microsoft Outlook</h3>
                
                <div class="help-text">
                    <h4><i class="fas fa-question-circle"></i> ¬øC√≥mo obtener las credenciales?</h4>
                    <ol>
                        <li>Ve a <a href="https://portal.azure.com" target="_blank">Azure Portal</a></li>
                        <li>Ve a "Azure Active Directory" ‚Üí "App registrations"</li>
                        <li>Crea una nueva aplicaci√≥n</li>
                        <li>Agrega permisos de "Microsoft Graph" ‚Üí "Calendars.ReadWrite"</li>
                        <li>Crea un "Client Secret" y copia el valor</li>
                    </ol>
                </div>
                
                <div class="form-group">
                    <label>Client ID (Application ID)</label>
                    <input type="text" id="outlookClientId" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                </div>
                
                <div class="form-group">
                    <label>Client Secret</label>
                    <input type="password" id="outlookClientSecret" placeholder="Tu client secret">
                    <small>Se almacena de forma segura y encriptada</small>
                </div>
                
                <div class="form-group">
                    <label>Tenant ID</label>
                    <input type="text" id="outlookTenantId" placeholder="common" value="common">
                    <small>Usa "common" para cuentas personales y de trabajo, o el tenant ID espec√≠fico</small>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="outlookTeams" checked>
                        Crear link de Microsoft Teams
                    </label>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" id="saveOutlookConfigBtn">
                        <i class="fas fa-save"></i> Guardar Configuraci√≥n
                    </button>
                    <button class="btn btn-primary" id="authorizeOutlookBtn">
                        <i class="fas fa-key"></i> Autorizar Acceso
                    </button>
                </div>
            </div>
            
            <!-- Working Hours -->
            <div class="config-section">
                <h3><i class="fas fa-clock"></i> Horario de Atenci√≥n</h3>
                <p class="muted-text mb-20">Define los horarios en que se pueden agendar citas</p>
                
                <div class="working-hours-grid">
                    <div class="day-row day-row-header">
                        <span>D√≠a</span>
                        <span>Inicio</span>
                        <span>Fin</span>
                        <span>Cerrado</span>
                    </div>
                    <div class="day-row">
                        <span class="day-label">Lunes</span>
                        <input type="time" id="monday_start" value="09:00">
                        <input type="time" id="monday_end" value="18:00">
                        <div class="closed-toggle"><input type="checkbox" id="monday_closed"></div>
                    </div>
                    <div class="day-row">
                        <span class="day-label">Martes</span>
                        <input type="time" id="tuesday_start" value="09:00">
                        <input type="time" id="tuesday_end" value="18:00">
                        <div class="closed-toggle"><input type="checkbox" id="tuesday_closed"></div>
                    </div>
                    <div class="day-row">
                        <span class="day-label">Mi√©rcoles</span>
                        <input type="time" id="wednesday_start" value="09:00">
                        <input type="time" id="wednesday_end" value="18:00">
                        <div class="closed-toggle"><input type="checkbox" id="wednesday_closed"></div>
                    </div>
                    <div class="day-row">
                        <span class="day-label">Jueves</span>
                        <input type="time" id="thursday_start" value="09:00">
                        <input type="time" id="thursday_end" value="18:00">
                        <div class="closed-toggle"><input type="checkbox" id="thursday_closed"></div>
                    </div>
                    <div class="day-row">
                        <span class="day-label">Viernes</span>
                        <input type="time" id="friday_start" value="09:00">
                        <input type="time" id="friday_end" value="17:00">
                        <div class="closed-toggle"><input type="checkbox" id="friday_closed"></div>
                    </div>
                    <div class="day-row">
                        <span class="day-label">S√°bado</span>
                        <input type="time" id="saturday_start" value="09:00">
                        <input type="time" id="saturday_end" value="13:00">
                        <div class="closed-toggle"><input type="checkbox" id="saturday_closed" checked></div>
                    </div>
                    <div class="day-row">
                        <span class="day-label">Domingo</span>
                        <input type="time" id="sunday_start" value="09:00">
                        <input type="time" id="sunday_end" value="13:00">
                        <div class="closed-toggle"><input type="checkbox" id="sunday_closed" checked></div>
                    </div>
                </div>
                
                <div class="form-row mt-20">
                    <div class="form-group">
                        <label>Duraci√≥n por defecto (minutos)</label>
                        <select id="defaultDuration">
                            <option value="15">15 minutos</option>
                            <option value="30" selected>30 minutos</option>
                            <option value="45">45 minutos</option>
                            <option value="60">1 hora</option>
                            <option value="90">1.5 horas</option>
                            <option value="120">2 horas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Buffer entre citas (minutos)</label>
                        <select id="bufferTime">
                            <option value="0">Sin buffer</option>
                            <option value="5">5 minutos</option>
                            <option value="10">10 minutos</option>
                            <option value="15" selected>15 minutos</option>
                            <option value="30">30 minutos</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-success" id="saveWorkingHoursBtn">
                    <i class="fas fa-save"></i> Guardar Horarios
                </button>
            </div>
            
            <!-- Enable/Disable Appointments -->
            <div class="config-section">
                <h3><i class="fas fa-toggle-on"></i> Activar Sistema de Citas</h3>
                
                <div class="form-group">
                    <label class="appointments-label">
                        <input type="checkbox" id="appointmentsEnabled" class="appointments-checkbox">
                        <span>Permitir que los usuarios agenden citas por WhatsApp</span>
                    </label>
                    <small>Cuando est√° activo, el bot detectar√° autom√°ticamente cuando un usuario quiere agendar una cita</small>
                </div>
                
                <button class="btn btn-primary" id="toggleAppointmentsBtn">
                    <i class="fas fa-power-off"></i> Aplicar Cambios
                </button>
            </div>
        </div>
    </div>

    <!-- requireAuth('/ui/login.html') -->
    <!-- window.Api apiJson apiRequest -->
    <script src="/ui/calendar_config.js" defer></script>
</body>
</html>
